import { Component, Input, Output, EventEmitter, ChangeDetectionStrategy } from '@angular/core';
import { BehaviorSubject, Subscription } from 'rxjs';
import { map } from 'rxjs/operators';
import { SHARE_BUTTONS } from 'ngx-sharebuttons';
import * as i0 from "@angular/core";
import * as i1 from "ngx-sharebuttons";
import * as i2 from "ngx-sharebuttons/button";
import * as i3 from "@angular/common";
import * as i4 from "./expand-button";
export class ShareButtons {
    constructor(_share) {
        this._share = _share;
        this._state$ = new BehaviorSubject({
            includedButtons: [],
            excludedButtons: [],
            userButtons: [],
            selectedButtons: [],
            expanded: true,
            shownCount: Object.keys(SHARE_BUTTONS).length
        });
        this._configSub$ = Subscription.EMPTY;
        this.theme = this._share.config.theme;
        /** Show buttons icons */
        this.showIcon = true;
        /** Show buttons text */
        this.showText = false;
        /** Share dialog opened event */
        this.opened = new EventEmitter();
        /** Share dialog closed event */
        this.closed = new EventEmitter();
    }
    ngOnInit() {
        this.state$ = this._state$.pipe(map((state) => {
            // Use component include buttons, otherwise fallback to the global include buttons
            const includedButtons = state.includedButtons && state.includedButtons.length ? state.includedButtons : state.userButtons;
            const userButtons = state.excludedButtons ? includedButtons.filter((btn) => state.excludedButtons.indexOf(btn) < 0) : includedButtons;
            const selectedButtons = userButtons.slice(0, state.expanded ? userButtons.length : state.shownCount);
            return {
                userButtons,
                selectedButtons,
                expanded: state.expanded,
                shownCount: state.shownCount,
                moreIcon: state.moreIcon,
                lessIcon: state.lessIcon,
                moreAriaLabel: state.moreAriaLabel,
                lessAriaLabel: state.lessAriaLabel
            };
        }));
        // Subscribe to share buttons config changes, This updates the component whenever a new button is added
        this._configSub$ = this._share.config$.subscribe((config) => {
            // Use global include buttons, otherwise fallback to all buttons
            const includedButtons = config.include.length ? config.include : Object.keys(SHARE_BUTTONS);
            const userButtons = includedButtons.filter((btn) => config.exclude.indexOf(btn) < 0);
            this.updateState({
                userButtons,
                expanded: false,
                moreIcon: config.moreButtonIcon,
                lessIcon: config.lessButtonIcon,
                moreAriaLabel: config.moreButtonAriaLabel,
                lessAriaLabel: config.lessButtonAriaLabel
            });
        });
    }
    ngOnChanges(changes) {
        const shouldUpdate = (changes['include'] && changes['include'].currentValue !== changes['include'].previousValue) ||
            (changes['exclude'] && changes['exclude'].currentValue !== changes['exclude'].previousValue) ||
            (changes['show'] && changes['show'].currentValue !== changes['show'].previousValue);
        if (shouldUpdate) {
            this.updateState({
                includedButtons: this.include,
                excludedButtons: this.exclude,
                shownCount: this.show
            });
        }
    }
    ngOnDestroy() {
        this._configSub$.unsubscribe();
        this._state$.complete();
    }
    updateState(state) {
        this._state$.next({ ...this._state$.value, ...state });
    }
}
ShareButtons.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: ShareButtons, deps: [{ token: i1.ShareService }], target: i0.ɵɵFactoryTarget.Component });
ShareButtons.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.4", type: ShareButtons, selector: "share-buttons", inputs: { theme: "theme", include: "include", exclude: "exclude", show: "show", url: "url", title: "title", description: "description", image: "image", tags: "tags", autoSetMeta: "autoSetMeta", showIcon: "showIcon", showText: "showText", disabled: "disabled" }, outputs: { opened: "opened", closed: "closed" }, usesOnChanges: true, ngImport: i0, template: "<div *ngIf=\"state$ | async; let state\" class=\"sb-group sb-{{theme}}\">\r\n  <share-button *ngFor=\"let button of state.selectedButtons\"\r\n                [button]=\"button\"\r\n                [theme]=\"theme\"\r\n                [url]=\"url\"\r\n                [title]=\"title\"\r\n                [description]=\"description\"\r\n                [image]=\"image\"\r\n                [tags]=\"tags\"\r\n                [autoSetMeta]=\"autoSetMeta\"\r\n                [showIcon]=\"showIcon\"\r\n                [showText]=\"showText\"\r\n                (opened)=\"opened.emit($event)\"\r\n                (closed)=\"closed.emit($event)\"\r\n                [disabled]=\"disabled\">\r\n  </share-button>\r\n  <expand-button *ngIf=\"state.shownCount < state.userButtons.length\"\r\n                 class=\"sb-button sb-{{theme}}\"\r\n                 [expanded]=\"state.expanded\"\r\n                 [moreIcon]=\"state.moreIcon\"\r\n                 [lessIcon]=\"state.lessIcon\"\r\n                 [moreAriaLabel]=\"state.moreAriaLabel\"\r\n                 [lessAriaLabel]=\"state.lessAriaLabel\"\r\n                 (toggle)=\"updateState({expanded: $event})\">\r\n  </expand-button>\r\n</div>\r\n", styles: [":host{display:inherit}.sb-group,.sb-button{display:inline-flex;align-items:flex-start}.sb-group{flex-wrap:wrap}\n"], dependencies: [{ kind: "component", type: i2.ShareButton, selector: "share-button", inputs: ["button", "url", "title", "description", "image", "tags", "autoSetMeta", "showIcon", "showText", "text", "icon", "theme", "disabled"], outputs: ["opened", "closed"] }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.ExpandButton, selector: "expand-button", inputs: ["moreIcon", "lessIcon", "expanded", "moreAriaLabel", "lessAriaLabel"], outputs: ["toggle"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: ShareButtons, decorators: [{
            type: Component,
            args: [{ selector: 'share-buttons', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div *ngIf=\"state$ | async; let state\" class=\"sb-group sb-{{theme}}\">\r\n  <share-button *ngFor=\"let button of state.selectedButtons\"\r\n                [button]=\"button\"\r\n                [theme]=\"theme\"\r\n                [url]=\"url\"\r\n                [title]=\"title\"\r\n                [description]=\"description\"\r\n                [image]=\"image\"\r\n                [tags]=\"tags\"\r\n                [autoSetMeta]=\"autoSetMeta\"\r\n                [showIcon]=\"showIcon\"\r\n                [showText]=\"showText\"\r\n                (opened)=\"opened.emit($event)\"\r\n                (closed)=\"closed.emit($event)\"\r\n                [disabled]=\"disabled\">\r\n  </share-button>\r\n  <expand-button *ngIf=\"state.shownCount < state.userButtons.length\"\r\n                 class=\"sb-button sb-{{theme}}\"\r\n                 [expanded]=\"state.expanded\"\r\n                 [moreIcon]=\"state.moreIcon\"\r\n                 [lessIcon]=\"state.lessIcon\"\r\n                 [moreAriaLabel]=\"state.moreAriaLabel\"\r\n                 [lessAriaLabel]=\"state.lessAriaLabel\"\r\n                 (toggle)=\"updateState({expanded: $event})\">\r\n  </expand-button>\r\n</div>\r\n", styles: [":host{display:inherit}.sb-group,.sb-button{display:inline-flex;align-items:flex-start}.sb-group{flex-wrap:wrap}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ShareService }]; }, propDecorators: { theme: [{
                type: Input
            }], include: [{
                type: Input
            }], exclude: [{
                type: Input
            }], show: [{
                type: Input
            }], url: [{
                type: Input
            }], title: [{
                type: Input
            }], description: [{
                type: Input
            }], image: [{
                type: Input
            }], tags: [{
                type: Input
            }], autoSetMeta: [{
                type: Input
            }], showIcon: [{
                type: Input
            }], showText: [{
                type: Input
            }], disabled: [{
                type: Input
            }], opened: [{
                type: Output
            }], closed: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUtYnV0dG9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1zaGFyZWJ1dHRvbnMvYnV0dG9ucy9zcmMvc2hhcmUtYnV0dG9ucy50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1zaGFyZWJ1dHRvbnMvYnV0dG9ucy9zcmMvc2hhcmUtYnV0dG9ucy5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFJTixZQUFZLEVBRVosdUJBQXVCLEVBQ3hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxlQUFlLEVBQUUsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVyQyxPQUFPLEVBQW9DLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDOzs7Ozs7QUFxQm5GLE1BQU0sT0FBTyxZQUFZO0lBMER2QixZQUFvQixNQUFvQjtRQUFwQixXQUFNLEdBQU4sTUFBTSxDQUFjO1FBdkRoQyxZQUFPLEdBQUcsSUFBSSxlQUFlLENBQWU7WUFDbEQsZUFBZSxFQUFFLEVBQUU7WUFDbkIsZUFBZSxFQUFFLEVBQUU7WUFDbkIsV0FBVyxFQUFFLEVBQUU7WUFDZixlQUFlLEVBQUUsRUFBRTtZQUNuQixRQUFRLEVBQUUsSUFBSTtZQUNkLFVBQVUsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLE1BQU07U0FDOUMsQ0FBQyxDQUFDO1FBRUssZ0JBQVcsR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDO1FBRWhDLFVBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUE2QjFDLHlCQUF5QjtRQUNoQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBRXpCLHdCQUF3QjtRQUNmLGFBQVEsR0FBRyxLQUFLLENBQUM7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O2dCQUdHLE1BQU07c0JBQWYsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIElucHV0LFxyXG4gIE91dHB1dCxcclxuICBPbkluaXQsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIE9uRGVzdHJveSxcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneVxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBCZWhhdmlvclN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBTaGFyZVNlcnZpY2UsIFNoYXJlQnV0dG9uc0NvbmZpZywgU0hBUkVfQlVUVE9OUyB9IGZyb20gJ25neC1zaGFyZWJ1dHRvbnMnO1xyXG5cclxuaW50ZXJmYWNlIEJ1dHRvbnNTdGF0ZSB7XHJcbiAgaW5jbHVkZWRCdXR0b25zPzogc3RyaW5nW107XHJcbiAgZXhjbHVkZWRCdXR0b25zPzogc3RyaW5nW107XHJcbiAgdXNlckJ1dHRvbnM/OiBzdHJpbmdbXTtcclxuICBzZWxlY3RlZEJ1dHRvbnM/OiBzdHJpbmdbXTtcclxuICBleHBhbmRlZD86IGJvb2xlYW47XHJcbiAgc2hvd25Db3VudD86IG51bWJlcjtcclxuICBtb3JlSWNvbj86IGFueTtcclxuICBsZXNzSWNvbj86IGFueTtcclxuICBtb3JlQXJpYUxhYmVsPzogc3RyaW5nO1xyXG4gIGxlc3NBcmlhTGFiZWw/OiBzdHJpbmc7XHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc2hhcmUtYnV0dG9ucycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NoYXJlLWJ1dHRvbnMuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc2hhcmUtYnV0dG9ucy5zY3NzJ10sXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIFNoYXJlQnV0dG9ucyBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG5cclxuICBzdGF0ZSQ6IE9ic2VydmFibGU8QnV0dG9uc1N0YXRlPjtcclxuICBwcml2YXRlIF9zdGF0ZSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEJ1dHRvbnNTdGF0ZT4oe1xyXG4gICAgaW5jbHVkZWRCdXR0b25zOiBbXSxcclxuICAgIGV4Y2x1ZGVkQnV0dG9uczogW10sXHJcbiAgICB1c2VyQnV0dG9uczogW10sXHJcbiAgICBzZWxlY3RlZEJ1dHRvbnM6IFtdLFxyXG4gICAgZXhwYW5kZWQ6IHRydWUsXHJcbiAgICBzaG93bkNvdW50OiBPYmplY3Qua2V5cyhTSEFSRV9CVVRUT05TKS5sZW5ndGhcclxuICB9KTtcclxuXHJcbiAgcHJpdmF0ZSBfY29uZmlnU3ViJCA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcclxuXHJcbiAgQElucHV0KCkgdGhlbWUgPSB0aGlzLl9zaGFyZS5jb25maWcudGhlbWU7XHJcblxyXG4gIC8qKiBBcnJheSBvZiBpbmNsdWRlZCBidXR0b25zICovXHJcbiAgQElucHV0KCkgaW5jbHVkZTogc3RyaW5nW107XHJcblxyXG4gIC8qKiBBcnJheSBvZiBleGNsdWRlZCBidXR0b25zICovXHJcbiAgQElucHV0KCkgZXhjbHVkZTogc3RyaW5nW107XHJcblxyXG4gIC8qKiBOdW1iZXJzIG9mIGJ1dHRvbnMgdG8gc2hvdyAqL1xyXG4gIEBJbnB1dCgpIHNob3c6IG51bWJlcjtcclxuXHJcbiAgLyoqIFRoZSBzaGFyaW5nIGxpbmsgKi9cclxuICBASW5wdXQoKSB1cmw6IHN0cmluZztcclxuXHJcbiAgLyoqIFRoZSB0aXRsZSBwYXJhbWV0ZXIgKi9cclxuICBASW5wdXQoKSB0aXRsZTogc3RyaW5nO1xyXG5cclxuICAvKiogVGhlIGRlc2NyaXB0aW9uIHBhcmFtZXRlciAqL1xyXG4gIEBJbnB1dCgpIGRlc2NyaXB0aW9uOiBzdHJpbmc7XHJcblxyXG4gIC8qKiBUaGUgaW1hZ2UgcGFyYW1ldGVyIGZvciBzaGFyaW5nIG9uIFBpbnRlcmVzdCAqL1xyXG4gIEBJbnB1dCgpIGltYWdlOiBzdHJpbmc7XHJcblxyXG4gIC8qKiBUaGUgdGFncyBwYXJhbWV0ZXIgZm9yIHNoYXJpbmcgb24gVHdpdHRlciBhbmQgVHVtYmxyICovXHJcbiAgQElucHV0KCkgdGFnczogc3RyaW5nO1xyXG5cclxuICAvKiogU2V0cyBtZXRhIHRhZ3MgZnJvbSBkb2N1bWVudCBoZWFkLCB1c2VmdWwgd2hlbiBTRU8gaXMgYXZhaWxhYmxlICovXHJcbiAgQElucHV0KCkgYXV0b1NldE1ldGE6IGJvb2xlYW47XHJcblxyXG4gIC8qKiBTaG93IGJ1dHRvbnMgaWNvbnMgKi9cclxuICBASW5wdXQoKSBzaG93SWNvbiA9IHRydWU7XHJcblxyXG4gIC8qKiBTaG93IGJ1dHRvbnMgdGV4dCAqL1xyXG4gIEBJbnB1dCgpIHNob3dUZXh0ID0gZmFsc2U7XHJcblxyXG4gIC8qKiBBIGZsYWcgdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIGJ1dHRvbidzIGNsaWNrIGlzIGRpc2FibGVkICovXHJcbiAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XHJcblxyXG4gIC8qKiBTaGFyZSBkaWFsb2cgb3BlbmVkIGV2ZW50ICovXHJcbiAgQE91dHB1dCgpIG9wZW5lZCA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xyXG5cclxuICAvKiogU2hhcmUgZGlhbG9nIGNsb3NlZCBldmVudCAqL1xyXG4gIEBPdXRwdXQoKSBjbG9zZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfc2hhcmU6IFNoYXJlU2VydmljZSkge1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLnN0YXRlJCA9IHRoaXMuX3N0YXRlJC5waXBlKFxyXG4gICAgICBtYXAoKHN0YXRlOiBCdXR0b25zU3RhdGUpID0+IHtcclxuICAgICAgICAvLyBVc2UgY29tcG9uZW50IGluY2x1ZGUgYnV0dG9ucywgb3RoZXJ3aXNlIGZhbGxiYWNrIHRvIHRoZSBnbG9iYWwgaW5jbHVkZSBidXR0b25zXHJcbiAgICAgICAgY29uc3QgaW5jbHVkZWRCdXR0b25zID0gc3RhdGUuaW5jbHVkZWRCdXR0b25zICYmIHN0YXRlLmluY2x1ZGVkQnV0dG9ucy5sZW5ndGggPyBzdGF0ZS5pbmNsdWRlZEJ1dHRvbnMgOiBzdGF0ZS51c2VyQnV0dG9ucztcclxuICAgICAgICBjb25zdCB1c2VyQnV0dG9ucyA9IHN0YXRlLmV4Y2x1ZGVkQnV0dG9ucyA/IGluY2x1ZGVkQnV0dG9ucy5maWx0ZXIoKGJ0bjogc3RyaW5nKSA9PiBzdGF0ZS5leGNsdWRlZEJ1dHRvbnMuaW5kZXhPZihidG4pIDwgMCkgOiBpbmNsdWRlZEJ1dHRvbnM7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRCdXR0b25zID0gdXNlckJ1dHRvbnMuc2xpY2UoMCwgc3RhdGUuZXhwYW5kZWQgPyB1c2VyQnV0dG9ucy5sZW5ndGggOiBzdGF0ZS5zaG93bkNvdW50KTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgdXNlckJ1dHRvbnMsXHJcbiAgICAgICAgICBzZWxlY3RlZEJ1dHRvbnMsXHJcbiAgICAgICAgICBleHBhbmRlZDogc3RhdGUuZXhwYW5kZWQsXHJcbiAgICAgICAgICBzaG93bkNvdW50OiBzdGF0ZS5zaG93bkNvdW50LFxyXG4gICAgICAgICAgbW9yZUljb246IHN0YXRlLm1vcmVJY29uLFxyXG4gICAgICAgICAgbGVzc0ljb246IHN0YXRlLmxlc3NJY29uLFxyXG4gICAgICAgICAgbW9yZUFyaWFMYWJlbDogc3RhdGUubW9yZUFyaWFMYWJlbCxcclxuICAgICAgICAgIGxlc3NBcmlhTGFiZWw6IHN0YXRlLmxlc3NBcmlhTGFiZWxcclxuICAgICAgICB9O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBTdWJzY3JpYmUgdG8gc2hhcmUgYnV0dG9ucyBjb25maWcgY2hhbmdlcywgVGhpcyB1cGRhdGVzIHRoZSBjb21wb25lbnQgd2hlbmV2ZXIgYSBuZXcgYnV0dG9uIGlzIGFkZGVkXHJcbiAgICB0aGlzLl9jb25maWdTdWIkID0gdGhpcy5fc2hhcmUuY29uZmlnJC5zdWJzY3JpYmUoKGNvbmZpZzogU2hhcmVCdXR0b25zQ29uZmlnKSA9PiB7XHJcbiAgICAgIC8vIFVzZSBnbG9iYWwgaW5jbHVkZSBidXR0b25zLCBvdGhlcndpc2UgZmFsbGJhY2sgdG8gYWxsIGJ1dHRvbnNcclxuICAgICAgY29uc3QgaW5jbHVkZWRCdXR0b25zID0gY29uZmlnLmluY2x1ZGUubGVuZ3RoID8gY29uZmlnLmluY2x1ZGUgOiBPYmplY3Qua2V5cyhTSEFSRV9CVVRUT05TKTtcclxuICAgICAgY29uc3QgdXNlckJ1dHRvbnMgPSBpbmNsdWRlZEJ1dHRvbnMuZmlsdGVyKChidG46IHN0cmluZykgPT4gY29uZmlnLmV4Y2x1ZGUuaW5kZXhPZihidG4pIDwgMCk7XHJcbiAgICAgIHRoaXMudXBkYXRlU3RhdGUoe1xyXG4gICAgICAgIHVzZXJCdXR0b25zLFxyXG4gICAgICAgIGV4cGFuZGVkOiBmYWxzZSxcclxuICAgICAgICBtb3JlSWNvbjogY29uZmlnLm1vcmVCdXR0b25JY29uLFxyXG4gICAgICAgIGxlc3NJY29uOiBjb25maWcubGVzc0J1dHRvbkljb24sXHJcbiAgICAgICAgbW9yZUFyaWFMYWJlbDogY29uZmlnLm1vcmVCdXR0b25BcmlhTGFiZWwsXHJcbiAgICAgICAgbGVzc0FyaWFMYWJlbDogY29uZmlnLmxlc3NCdXR0b25BcmlhTGFiZWxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIGNvbnN0IHNob3VsZFVwZGF0ZSA9XHJcbiAgICAgIChjaGFuZ2VzWydpbmNsdWRlJ10gJiYgY2hhbmdlc1snaW5jbHVkZSddLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlc1snaW5jbHVkZSddLnByZXZpb3VzVmFsdWUpIHx8XHJcbiAgICAgIChjaGFuZ2VzWydleGNsdWRlJ10gJiYgY2hhbmdlc1snZXhjbHVkZSddLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlc1snZXhjbHVkZSddLnByZXZpb3VzVmFsdWUpIHx8XHJcbiAgICAgIChjaGFuZ2VzWydzaG93J10gJiYgY2hhbmdlc1snc2hvdyddLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlc1snc2hvdyddLnByZXZpb3VzVmFsdWUpO1xyXG5cclxuICAgIGlmIChzaG91bGRVcGRhdGUpIHtcclxuICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7XHJcbiAgICAgICAgaW5jbHVkZWRCdXR0b25zOiB0aGlzLmluY2x1ZGUsXHJcbiAgICAgICAgZXhjbHVkZWRCdXR0b25zOiB0aGlzLmV4Y2x1ZGUsXHJcbiAgICAgICAgc2hvd25Db3VudDogdGhpcy5zaG93XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLl9jb25maWdTdWIkLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB0aGlzLl9zdGF0ZSQuY29tcGxldGUoKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVN0YXRlKHN0YXRlOiBCdXR0b25zU3RhdGUpIHtcclxuICAgIHRoaXMuX3N0YXRlJC5uZXh0KHsuLi50aGlzLl9zdGF0ZSQudmFsdWUsIC4uLnN0YXRlfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuLyoqXHJcbiAqIEV4cGxhbmF0aW9uIG9mIHRoZSBhYm92ZSBjb2RlOlxyXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuIEluY2x1ZGUgYnV0dG9uczogaW5jbHVkZXMgb25seSB3YW50ZWQgYnV0dG9ucyBhbmQgZXhjbHVkZXMgdGhlIHJlc3RcclxuIEV4Y2x1ZGUgYnV0dG9uczogZXhjbHVkZXMgb25seSB0aGUgdW53YW50ZWQgYnV0dG9uc1xyXG4gVXNlciBidXR0b25zID0gSW5jbHVkZSBidXR0b25zIC0gZXhjbHVkZSBidXR0b25zXHJcbiBTZWxlY3RlZCBCdXR0b25zID0gVXNlciBidXR0b25zIFtzaG93biBudW1iZXJdXHJcbiAqL1xyXG4iLCI8ZGl2ICpuZ0lmPVwic3RhdGUkIHwgYXN5bmM7IGxldCBzdGF0ZVwiIGNsYXNzPVwic2ItZ3JvdXAgc2Ite3t0aGVtZX19XCI+XHJcbiAgPHNoYXJlLWJ1dHRvbiAqbmdGb3I9XCJsZXQgYnV0dG9uIG9mIHN0YXRlLnNlbGVjdGVkQnV0dG9uc1wiXHJcbiAgICAgICAgICAgICAgICBbYnV0dG9uXT1cImJ1dHRvblwiXHJcbiAgICAgICAgICAgICAgICBbdGhlbWVdPVwidGhlbWVcIlxyXG4gICAgICAgICAgICAgICAgW3VybF09XCJ1cmxcIlxyXG4gICAgICAgICAgICAgICAgW3RpdGxlXT1cInRpdGxlXCJcclxuICAgICAgICAgICAgICAgIFtkZXNjcmlwdGlvbl09XCJkZXNjcmlwdGlvblwiXHJcbiAgICAgICAgICAgICAgICBbaW1hZ2VdPVwiaW1hZ2VcIlxyXG4gICAgICAgICAgICAgICAgW3RhZ3NdPVwidGFnc1wiXHJcbiAgICAgICAgICAgICAgICBbYXV0b1NldE1ldGFdPVwiYXV0b1NldE1ldGFcIlxyXG4gICAgICAgICAgICAgICAgW3Nob3dJY29uXT1cInNob3dJY29uXCJcclxuICAgICAgICAgICAgICAgIFtzaG93VGV4dF09XCJzaG93VGV4dFwiXHJcbiAgICAgICAgICAgICAgICAob3BlbmVkKT1cIm9wZW5lZC5lbWl0KCRldmVudClcIlxyXG4gICAgICAgICAgICAgICAgKGNsb3NlZCk9XCJjbG9zZWQuZW1pdCgkZXZlbnQpXCJcclxuICAgICAgICAgICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiPlxyXG4gIDwvc2hhcmUtYnV0dG9uPlxyXG4gIDxleHBhbmQtYnV0dG9uICpuZ0lmPVwic3RhdGUuc2hvd25Db3VudCA8IHN0YXRlLnVzZXJCdXR0b25zLmxlbmd0aFwiXHJcbiAgICAgICAgICAgICAgICAgY2xhc3M9XCJzYi1idXR0b24gc2Ite3t0aGVtZX19XCJcclxuICAgICAgICAgICAgICAgICBbZXhwYW5kZWRdPVwic3RhdGUuZXhwYW5kZWRcIlxyXG4gICAgICAgICAgICAgICAgIFttb3JlSWNvbl09XCJzdGF0ZS5tb3JlSWNvblwiXHJcbiAgICAgICAgICAgICAgICAgW2xlc3NJY29uXT1cInN0YXRlLmxlc3NJY29uXCJcclxuICAgICAgICAgICAgICAgICBbbW9yZUFyaWFMYWJlbF09XCJzdGF0ZS5tb3JlQXJpYUxhYmVsXCJcclxuICAgICAgICAgICAgICAgICBbbGVzc0FyaWFMYWJlbF09XCJzdGF0ZS5sZXNzQXJpYUxhYmVsXCJcclxuICAgICAgICAgICAgICAgICAodG9nZ2xlKT1cInVwZGF0ZVN0YXRlKHtleHBhbmRlZDogJGV2ZW50fSlcIj5cclxuICA8L2V4cGFuZC1idXR0b24+XHJcbjwvZGl2PlxyXG4iXX0=